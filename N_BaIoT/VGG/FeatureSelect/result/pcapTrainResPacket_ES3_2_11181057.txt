2024-11-18 10:57:20.250036: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
当前脚本的文件名是: pcapTrainResPacket_ES3_2.py
2024-11-18 10:57:22.548850: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX512F
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-11-18 10:57:22.556830: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 10:57:22.557931: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2024-11-18 10:57:22.564181: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:3b:00.0 name: NVIDIA GeForce RTX 4090 computeCapability: 8.9
coreClock: 2.625GHz coreCount: 128 deviceMemorySize: 23.65GiB deviceMemoryBandwidth: 938.86GiB/s
2024-11-18 10:57:22.564225: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:57:22.567048: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 10:57:22.567126: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 10:57:22.568283: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 10:57:22.568591: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 10:57:22.571566: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 10:57:22.572295: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 10:57:22.572473: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 10:57:22.572869: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 10:57:22.572900: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:57:23.240771: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 10:57:23.240822: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 10:57:23.240830: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 10:57:23.241538: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19912 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 4090, pci bus id: 0000:3b:00.0, compute capability: 8.9)
init data completed!
2024-11-18 10:59:17.761751: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 10:59:17.762486: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:3b:00.0 name: NVIDIA GeForce RTX 4090 computeCapability: 8.9
coreClock: 2.625GHz coreCount: 128 deviceMemorySize: 23.65GiB deviceMemoryBandwidth: 938.86GiB/s
2024-11-18 10:59:17.762533: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:59:17.762625: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 10:59:17.762650: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 10:59:17.762676: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 10:59:17.762718: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 10:59:17.762745: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 10:59:17.762774: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 10:59:17.762796: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 10:59:17.763171: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 10:59:17.817244: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 10:59:17.817740: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:3b:00.0 name: NVIDIA GeForce RTX 4090 computeCapability: 8.9
coreClock: 2.625GHz coreCount: 128 deviceMemorySize: 23.65GiB deviceMemoryBandwidth: 938.86GiB/s
2024-11-18 10:59:17.817780: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:59:17.817826: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 10:59:17.817844: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 10:59:17.817862: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 10:59:17.817879: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 10:59:17.817896: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 10:59:17.817912: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 10:59:17.817930: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 10:59:17.818261: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 10:59:17.818366: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 10:59:17.818378: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 10:59:17.818386: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 10:59:17.818900: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19912 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 4090, pci bus id: 0000:3b:00.0, compute capability: 8.9)
2024-11-18 10:59:18.220442: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:196] None of the MLIR optimization passes are enabled (registered 0 passes)
2024-11-18 10:59:18.238340: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2100000000 Hz
2024-11-18 10:59:19.142087: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 10:59:19.747885: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 10:59:19.752841: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 10:59:22.163861: W tensorflow/stream_executor/gpu/asm_compiler.cc:63] Running ptxas --version returned 256
2024-11-18 10:59:22.345380: W tensorflow/stream_executor/gpu/redzone_allocator.cc:314] Internal: ptxas exited with non-zero error code 256, output: 
Relying on driver to perform ptx compilation. 
Modify $PATH to customize ptxas location.
This message will be only logged once.
2024-11-18 10:59:55.181297: I tensorflow/stream_executor/cuda/cuda_blas.cc:1838] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
Epoch 1 completed, average loss: 6.937001292591592, duration: 151.89 seconds
Macro-F1: 0.9543210887181927
Micro-F1: 0.950606902776788
Epoch 2 completed, average loss: 0.8412713520044395, duration: 64.60 seconds
Macro-F1: 0.9462232429219681
Micro-F1: 0.9428775030285755
Epoch 3 completed, average loss: 0.5562255683473725, duration: 64.37 seconds
Macro-F1: 0.9948061797406034
Micro-F1: 0.9942563956388513
Epoch 3, Intersection size: 2
Epoch 4 completed, average loss: 0.27382845663219685, duration: 63.60 seconds
Macro-F1: 0.9994863042770189
Micro-F1: 0.9995486828665764
Epoch 4, Intersection size: 2
Epoch 5 completed, average loss: 0.20537642025453584, duration: 65.27 seconds
Macro-F1: 0.9996291501741128
Micro-F1: 0.9996531984132639
Epoch 5, Intersection size: 1
Epoch 6 completed, average loss: 0.1851249086125182, duration: 66.79 seconds
Macro-F1: 0.9996457937170757
Micro-F1: 0.9996436969999287
Epoch 6, Intersection size: 1
Epoch 7 completed, average loss: 0.16361556438875285, duration: 65.08 seconds
Macro-F1: 0.999612348015749
Micro-F1: 0.9996294448799259
Epoch 7, Intersection size: 1
Epoch 8 completed, average loss: 0.1664614886480413, duration: 64.66 seconds
Macro-F1: 0.9996922143999308
Micro-F1: 0.9996817026532697
Epoch 8, Intersection size: 1
Epoch 9 completed, average loss: 0.17521721287369574, duration: 53.66 seconds
Macro-F1: 0.9997535234406444
Micro-F1: 0.9997957196132925
Epoch 9, Intersection size: 2
Epoch 10 completed, average loss: 0.15135635364706515, duration: 64.96 seconds
Macro-F1: 0.9997983543404515
Micro-F1: 0.9998289745599658
Epoch 10, Intersection size: 2
Epoch 11 completed, average loss: 0.15811838612158471, duration: 65.79 seconds
Macro-F1: 0.9997276987341523
Micro-F1: 0.9997197083066106
Epoch 11, Intersection size: 1
Epoch 12 completed, average loss: 0.1175402006931003, duration: 64.13 seconds
Macro-F1: 0.99957816443747
Micro-F1: 0.9996864533599373
Epoch 12, Intersection size: 1
Epoch 13 completed, average loss: 0.1081247083223329, duration: 64.06 seconds
Macro-F1: 0.9997528342388392
Micro-F1: 0.999738711133281
Epoch 13, Intersection size: 1
Epoch 14 completed, average loss: 0.14134043136479055, duration: 63.98 seconds
Macro-F1: 0.9998936238016389
Micro-F1: 0.9999239886933181
Epoch 14, Intersection size: 1
Epoch 15 completed, average loss: 0.12779633876772203, duration: 63.88 seconds
Macro-F1: 0.999815589224916
Micro-F1: 0.9998669802133068
Epoch 15, Intersection size: 2
Epoch 16 completed, average loss: 0.0939331176281286, duration: 65.49 seconds
Macro-F1: 0.9998803896976362
Micro-F1: 0.9999144872799829
Epoch 16, Intersection size: 2
Epoch 17 completed, average loss: 0.12980101756209783, duration: 63.05 seconds
Macro-F1: 0.9998919668716085
Micro-F1: 0.9999239886933181
Epoch 17, Intersection size: 2
Epoch 18 completed, average loss: 0.09775182645955308, duration: 62.62 seconds
Macro-F1: 0.9999222385466645
Micro-F1: 0.9999429915199886
Epoch 18, Intersection size: 2
Epoch 19 completed, average loss: 0.0995870471439512, duration: 62.44 seconds
Macro-F1: 0.9998976256279901
Micro-F1: 0.9999287393999857
Epoch 19, Intersection size: 2
Epoch 20 completed, average loss: 0.1305929813742762, duration: 62.65 seconds
Macro-F1: 0.9999037279902474
Micro-F1: 0.9999334901066533
Epoch 20, Intersection size: 2
TSMRecord—100 [2, 2, 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]
loss_history—100 [6.937001292591592, 0.8412713520044395, 0.5562255683473725, 0.27382845663219685, 0.20537642025453584, 0.1851249086125182, 0.16361556438875285, 0.1664614886480413, 0.17521721287369574, 0.15135635364706515, 0.15811838612158471, 0.1175402006931003, 0.1081247083223329, 0.14134043136479055, 0.12779633876772203, 0.0939331176281286, 0.12980101756209783, 0.09775182645955308, 0.0995870471439512, 0.1305929813742762]
Total training time: 18725.13 seconds
scaling_factor_value： [[ 7.60248423e-01  9.51776743e-01  9.54290032e-01  9.38644171e-01
   9.63696599e-01  9.85773265e-01  1.03602326e+00  1.01920640e+00
   1.02432215e+00  1.02375150e+00  1.00687182e+00  9.99665499e-01
   9.17155921e-01  9.99879718e-01  9.87125576e-01  8.83295417e-01
   9.97013211e-01  9.54700828e-01  9.21926618e-01  9.62460220e-01
   9.78990555e-01  9.99313891e-01  9.99559402e-01  9.66165304e-01
   1.00140882e+00  9.98755515e-01  9.94958460e-01  9.81768966e-01
   1.03376782e+00  1.00118029e+00  9.63472486e-01  9.38974977e-01
   5.27421296e-01  9.25340712e-01 -5.27456359e-06  6.59359157e-01
   9.90584493e-01  8.95097733e-01  9.53198493e-01 -1.43324144e-06
   9.71942425e-01  1.43065963e-05  9.33977067e-01  9.99273539e-01
   9.82302964e-01  9.82073367e-01  4.55983900e-06  9.66962218e-01
   1.43083398e-05  9.77064431e-01  1.02796960e+00  1.00409460e+00
   9.62507784e-01  1.01941396e-07  9.79459822e-01  1.12094167e-05
   4.93661761e-01  9.51726913e-01  9.55883861e-01  9.31460619e-01
   9.63499956e-03  9.74046052e-01  3.71592253e-01  4.83268350e-01
   9.00993824e-01 -7.57048954e-04  1.00607562e+00  3.94923747e-01
   2.53721744e-01  9.62185442e-01  6.08212411e-01  4.76315588e-01
   9.51844573e-01  7.20336914e-01  8.33268642e-01  9.61618662e-01
   7.37887442e-01  8.87208223e-01  9.87527370e-01  9.39944029e-01
  -1.29475284e-05  9.48747098e-01 -1.64596768e-05  9.64753866e-01
  -2.71315585e-05  5.95441759e-01  6.10165477e-01 -6.04249681e-06
   8.80086839e-01 -4.14491569e-06  8.76783848e-01 -1.02875274e-05
   6.09958370e-05  3.10272664e-01  1.99654569e-05  8.89576912e-01
  -7.28999737e-07  9.59600806e-01 -1.18825337e-05  4.75304753e-01
   2.65355408e-01  8.80938411e-01  9.89466965e-01  1.77153890e-06
   9.51085508e-01  5.19928108e-06  8.96339589e-06  1.62308879e-06
   1.44586093e-05  9.34831262e-01 -5.58694228e-06  8.78481686e-01
   5.30101534e-06  1.90875362e-05  9.44734256e-06]]
start testing...
sorted_indices： [  6  28  50   8   9   7  10  66  51  24  29  13  11  22  21  43  25  16
  26  36 102  78  14   5  44  45  27  54  20  49  61  40  47  23  83   4
  30  52  19  69  75  97  58  17   2  38  72   1  57 104  81  79  31   3
 109  42  59  33  18  12  64  37  95  77  15 101  88 111  90  74   0  76
  73  35  86  70  85  32  56  63  71  99  67  62  93 100  68  60  92  94
 113 108  48  41  55 114 106 112 105  46 103 107  53  96  39  89  34 110
  87  91  98  80  82  84  65]
Processed 10000 rows
Processed 20000 rows
Processed 30000 rows
Processed 40000 rows
Processed 50000 rows
Processed 60000 rows
Processed 70000 rows
Processed 80000 rows
Processed 90000 rows
Processed 100000 rows
Processed 110000 rows
Processed 120000 rows
Processed 130000 rows
Processed 140000 rows
Processed 150000 rows
Processed 160000 rows
Processed 170000 rows
Processed 180000 rows
Processed 190000 rows
Processed 200000 rows
Processed 210000 rows
0 0.9997299304570927 14807 14811
1 0.9999673810222788 30656 30657
2 0.9998914636131763 36850 36854
3 1.0 32334 32334
4 0.9999719180005616 71218 71220
5 0.9998781428977619 24616 24619
Top-1 accuracy: 0.9999334901066533
Top-3 accuracy: 1.0
Top-5 accuracy: 1.0
Macro-F1: 0.9999037279902474
Micro-F1: 0.9999334901066533
loss_history [6.937001292591592, 0.8412713520044395, 0.5562255683473725, 0.27382845663219685, 0.20537642025453584, 0.1851249086125182, 0.16361556438875285, 0.1664614886480413, 0.17521721287369574, 0.15135635364706515, 0.15811838612158471, 0.1175402006931003, 0.1081247083223329, 0.14134043136479055, 0.12779633876772203, 0.0939331176281286, 0.12980101756209783, 0.09775182645955308, 0.0995870471439512, 0.1305929813742762]
macro_F1List [0.950606902776788, 0.9428775030285755, 0.9942563956388513, 0.9995486828665764, 0.9996531984132639, 0.9996436969999287, 0.9996294448799259, 0.9996817026532697, 0.9997957196132925, 0.9998289745599658, 0.9997197083066106, 0.9996864533599373, 0.999738711133281, 0.9999239886933181, 0.9998669802133068, 0.9999144872799829, 0.9999239886933181, 0.9999429915199886, 0.9999287393999857, 0.9999334901066533]
micro_F1List [0.9543210887181927, 0.9462232429219681, 0.9948061797406034, 0.9994863042770189, 0.9996291501741128, 0.9996457937170757, 0.999612348015749, 0.9996922143999308, 0.9997535234406444, 0.9997983543404515, 0.9997276987341523, 0.99957816443747, 0.9997528342388392, 0.9998936238016389, 0.999815589224916, 0.9998803896976362, 0.9998919668716085, 0.9999222385466645, 0.9998976256279901, 0.9999037279902474]
starting retraining
K= 2 top_k_indices [ 6 28]
init data completed!
2024-11-18 16:28:53.196784: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 16:28:53.197281: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:3b:00.0 name: NVIDIA GeForce RTX 4090 computeCapability: 8.9
coreClock: 2.625GHz coreCount: 128 deviceMemorySize: 23.65GiB deviceMemoryBandwidth: 938.86GiB/s
2024-11-18 16:28:53.197322: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 16:28:53.197381: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 16:28:53.197398: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 16:28:53.197416: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 16:28:53.197435: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 16:28:53.197454: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 16:28:53.197474: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 16:28:53.197493: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 16:28:53.197815: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 16:28:53.197876: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 16:28:53.197886: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 16:28:53.197894: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 16:28:53.198254: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 19912 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 4090, pci bus id: 0000:3b:00.0, compute capability: 8.9)
start retraining...
Macro-F1: 0.999454373419042
Micro-F1: 0.9994679208532269
Epoch 1 completed, average loss: 2.630520097687073, duration: 1723.00 seconds
Macro-F1: 0.9996855914907128
Micro-F1: 0.9997102068932754
Epoch 2 completed, average loss: 1.2498721254490166, duration: 1674.48 seconds
Macro-F1: 0.9998620030184311
Micro-F1: 0.9998622295066392
Epoch 3 completed, average loss: 0.9377053810407079, duration: 1549.79 seconds
Macro-F1: 0.9998913157992048
Micro-F1: 0.99990023515998
Epoch 4 completed, average loss: 0.958422036069776, duration: 1168.66 seconds
Macro-F1: 0.9998736997604151
Micro-F1: 0.9998812323333096
Epoch 5 completed, average loss: 0.5972751630490762, duration: 1118.07 seconds
