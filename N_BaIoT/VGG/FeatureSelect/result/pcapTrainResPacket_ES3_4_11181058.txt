2024-11-18 10:58:04.046628: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
当前脚本的文件名是: pcapTrainResPacket_ES3_4.py
2024-11-18 10:58:06.350915: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX512F
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-11-18 10:58:06.361482: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 10:58:06.363977: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2024-11-18 10:58:06.373489: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-18 10:58:06.373538: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:58:06.376774: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 10:58:06.376857: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 10:58:06.378011: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 10:58:06.378343: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 10:58:06.381361: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 10:58:06.382048: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 10:58:06.382237: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 10:58:06.382659: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 10:58:06.382693: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 10:58:07.020189: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 10:58:07.020247: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 10:58:07.020256: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 10:58:07.021044: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21668 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
init data completed!
2024-11-18 11:00:04.689081: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 11:00:04.690071: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-18 11:00:04.690118: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 11:00:04.690182: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 11:00:04.690204: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 11:00:04.690229: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 11:00:04.690266: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 11:00:04.690292: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 11:00:04.690322: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 11:00:04.690344: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 11:00:04.690697: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 11:00:04.738402: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 11:00:04.738739: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-18 11:00:04.738770: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 11:00:04.738802: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 11:00:04.738816: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 11:00:04.738830: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 11:00:04.738843: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 11:00:04.738857: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 11:00:04.738870: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 11:00:04.738883: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 11:00:04.739203: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 11:00:04.739273: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 11:00:04.739285: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 11:00:04.739292: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 11:00:04.739690: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21668 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
2024-11-18 11:00:05.110385: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:196] None of the MLIR optimization passes are enabled (registered 0 passes)
2024-11-18 11:00:05.125623: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2100000000 Hz
2024-11-18 11:00:06.022695: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 11:00:06.571109: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 11:00:06.575246: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 11:00:08.826715: W tensorflow/stream_executor/gpu/asm_compiler.cc:63] Running ptxas --version returned 256
2024-11-18 11:00:09.018283: W tensorflow/stream_executor/gpu/redzone_allocator.cc:314] Internal: ptxas exited with non-zero error code 256, output: 
Relying on driver to perform ptx compilation. 
Modify $PATH to customize ptxas location.
This message will be only logged once.
2024-11-18 11:00:44.612332: I tensorflow/stream_executor/cuda/cuda_blas.cc:1838] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
Epoch 1 completed, average loss: 6.289406277790786, duration: 164.51 seconds
Macro-F1: 0.9954036395351058
Micro-F1: 0.9949024917456472
Epoch 2 completed, average loss: 0.5185154307753057, duration: 79.17 seconds
Macro-F1: 0.9987771834727837
Micro-F1: 0.9989880994797976
Epoch 3 completed, average loss: 0.2562059165872507, duration: 78.71 seconds
Macro-F1: 0.9990961774384169
Micro-F1: 0.9993871588398774
Epoch 3, Intersection size: 3
Epoch 4 completed, average loss: 0.19917154258346695, duration: 78.48 seconds
Macro-F1: 0.9995374421614988
Micro-F1: 0.9996436969999287
Epoch 4, Intersection size: 3
Epoch 5 completed, average loss: 0.1498498231588101, duration: 78.36 seconds
Macro-F1: 0.9998635132899354
Micro-F1: 0.9999097365733153
Epoch 5, Intersection size: 3
Epoch 6 completed, average loss: 0.18428601845535786, duration: 78.45 seconds
Macro-F1: 0.9997346358318518
Micro-F1: 0.9997909689066249
Epoch 6, Intersection size: 4
Epoch 7 completed, average loss: 0.12374884075979593, duration: 74.46 seconds
Macro-F1: 0.9998587456276251
Micro-F1: 0.9999097365733153
Epoch 7, Intersection size: 4
Epoch 8 completed, average loss: 0.13482775395468619, duration: 78.85 seconds
Macro-F1: 0.9998885353785231
Micro-F1: 0.9999192379866505
Epoch 8, Intersection size: 4
Epoch 9 completed, average loss: 0.11468636362012674, duration: 78.88 seconds
Macro-F1: 0.9998997445658119
Micro-F1: 0.9999334901066533
Epoch 9, Intersection size: 3
Epoch 10 completed, average loss: 0.11253460056270073, duration: 78.73 seconds
Macro-F1: 0.9998997445658119
Micro-F1: 0.9999334901066533
Epoch 10, Intersection size: 3
Epoch 11 completed, average loss: 0.12978901948264282, duration: 78.70 seconds
Macro-F1: 0.9998997445658119
Micro-F1: 0.9999334901066533
Epoch 11, Intersection size: 4
Epoch 12 completed, average loss: 0.10882383423614912, duration: 78.75 seconds
Macro-F1: 0.9998936410810089
Micro-F1: 0.9999287393999857
Epoch 12, Intersection size: 4
Epoch 13 completed, average loss: 0.09013184795147869, duration: 78.54 seconds
Macro-F1: 0.9998997445658119
Micro-F1: 0.9999334901066533
Epoch 13, Intersection size: 4
Epoch 14 completed, average loss: 0.12143760118201465, duration: 77.66 seconds
Macro-F1: 0.9998875381329918
Micro-F1: 0.9999239886933181
Epoch 14, Intersection size: 4
Epoch 15 completed, average loss: 0.10774121101841753, duration: 78.19 seconds
Macro-F1: 0.9998997440778093
Micro-F1: 0.9999334901066533
Epoch 15, Intersection size: 4
Epoch 16 completed, average loss: 0.10290066787576439, duration: 78.43 seconds
Macro-F1: 0.9998997440778093
Micro-F1: 0.9999334901066533
Epoch 16, Intersection size: 4
Epoch 17 completed, average loss: 0.09961645356419499, duration: 78.44 seconds
Macro-F1: 0.9998900664363388
Micro-F1: 0.9999239886933181
Epoch 17, Intersection size: 4
Epoch 18 completed, average loss: 0.08139581146077436, duration: 78.28 seconds
Macro-F1: 0.9999076913941441
Micro-F1: 0.9999287393999857
Epoch 18, Intersection size: 3
Epoch 19 completed, average loss: 0.08975704862855827, duration: 78.00 seconds
Macro-F1: 0.9998936410810089
Micro-F1: 0.9999287393999857
Epoch 19, Intersection size: 3
Epoch 20 completed, average loss: 0.10117863105056123, duration: 75.09 seconds
Macro-F1: 0.9999137943421612
Micro-F1: 0.9999334901066533
Epoch 20, Intersection size: 3
TSMRecord—100 [3, 3, 3, 4, 4, 4, 3, 3, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3]
loss_history—100 [6.289406277790786, 0.5185154307753057, 0.2562059165872507, 0.19917154258346695, 0.1498498231588101, 0.18428601845535786, 0.12374884075979593, 0.13482775395468619, 0.11468636362012674, 0.11253460056270073, 0.12978901948264282, 0.10882383423614912, 0.09013184795147869, 0.12143760118201465, 0.10774121101841753, 0.10290066787576439, 0.09961645356419499, 0.08139581146077436, 0.08975704862855827, 0.10117863105056123]
Total training time: 26006.49 seconds
scaling_factor_value： [[ 9.0566683e-01  9.6235359e-01  9.7958803e-01  9.8515999e-01
   9.3649876e-01  9.6639949e-01  9.7489417e-01  9.9959105e-01
   9.8721087e-01  1.0543685e+00  9.7689527e-01  9.0657079e-01
   1.0071964e+00  9.6524948e-01  1.0023984e+00  8.9690912e-01
   9.0381527e-01  9.4285917e-01  9.4224846e-01  9.5762402e-01
   9.7866273e-01  1.0121391e+00  1.0215725e+00  1.0488075e+00
   9.9631804e-01  1.0137610e+00  1.0415215e+00  9.4858170e-01
   1.0232319e+00  1.0028455e+00  8.5830820e-01  9.6502763e-01
  -6.6988775e-08  9.7901958e-01  5.5807504e-08  6.6917413e-01
   9.6072078e-01  6.8986040e-01  9.0218455e-01 -1.2721307e-06
   8.4384823e-01 -6.8885438e-06  7.4747807e-01  9.4285595e-01
   7.7998435e-01  8.1290644e-01 -7.9543111e-07  8.0958468e-01
   4.4434364e-06  9.1560549e-01  9.7453886e-01  9.4112784e-01
   7.8009790e-01  3.1978020e-06  8.9460647e-01  4.3548675e-06
   6.0265261e-01  9.1110289e-01  9.3063730e-01  8.2462668e-01
  -6.5854942e-07  9.4505060e-01 -1.7414777e-06  5.9680933e-01
   9.8604512e-01  1.4880870e-01  8.6885673e-01  6.2036532e-01
   4.6109778e-01  9.1095084e-01  4.4290534e-01  4.2859638e-01
   9.2784727e-01  6.3878107e-01  7.8294611e-01  8.7590665e-01
   7.4128479e-01  4.4082186e-01  8.8687944e-01  8.2403129e-01
   2.7513038e-03  9.1848248e-01 -2.5670131e-05  8.6321688e-01
   1.0457844e-05  3.7269186e-02  1.9604553e-01 -1.3762987e-06
   8.1598121e-01 -9.2776263e-06  8.2195306e-01  7.7621735e-07
   2.6831137e-06  3.1097743e-06  4.5231655e-03  7.3793155e-01
   8.0007703e-06  8.6190444e-01 -8.0050959e-06  3.8515639e-01
   4.0738520e-01  8.4294593e-01  9.5178819e-01 -6.5425593e-07
   8.7514168e-01 -1.5694650e-06 -1.3156063e-05  1.3477375e-06
   2.3775763e-06  8.8716012e-01 -2.2706723e-05  2.1601039e-01
  -4.2031952e-06  4.8323345e-06 -5.4081156e-06]]
start testing...
sorted_indices： [  9  23  26  28  22  25  21  12  29  14   7  24   8  64   3   2  33  20
  10   6  50   5  13  31   1  36  19 102  27  61  17  43  18  51   4  58
  72  81  49  57  69  11   0  16  38  15  54 109  78  75 104  66  83  97
  30  40 101  59  79  90  88  45  47  74  52  44  42  76  95  37  35  73
  67  56  63  68  70  77  71 100  99 111  86  65  85  94  80  84  96 113
  48  55  53  93  92 108 107  91  34  32 103  60  46  39  87 105  62 112
 114  41  98  89 106 110  82]
Processed 10000 rows
Processed 20000 rows
Processed 30000 rows
Processed 40000 rows
Processed 50000 rows
Processed 60000 rows
Processed 70000 rows
Processed 80000 rows
Processed 90000 rows
Processed 100000 rows
Processed 110000 rows
Processed 120000 rows
Processed 130000 rows
Processed 140000 rows
Processed 150000 rows
Processed 160000 rows
Processed 170000 rows
Processed 180000 rows
Processed 190000 rows
Processed 200000 rows
Processed 210000 rows
0 0.9999324826142731 14810 14811
1 0.999869524089115 30653 30657
2 0.9998914636131763 36850 36854
3 0.9999072184078679 32331 32334
4 1.0 71220 71220
5 0.9999187619318413 24617 24619
Top-1 accuracy: 0.9999334901066533
Top-3 accuracy: 1.0
Top-5 accuracy: 1.0
Macro-F1: 0.9999137943421612
Micro-F1: 0.9999334901066533
loss_history [6.289406277790786, 0.5185154307753057, 0.2562059165872507, 0.19917154258346695, 0.1498498231588101, 0.18428601845535786, 0.12374884075979593, 0.13482775395468619, 0.11468636362012674, 0.11253460056270073, 0.12978901948264282, 0.10882383423614912, 0.09013184795147869, 0.12143760118201465, 0.10774121101841753, 0.10290066787576439, 0.09961645356419499, 0.08139581146077436, 0.08975704862855827, 0.10117863105056123]
macro_F1List [0.9949024917456472, 0.9989880994797976, 0.9993871588398774, 0.9996436969999287, 0.9999097365733153, 0.9997909689066249, 0.9999097365733153, 0.9999192379866505, 0.9999334901066533, 0.9999334901066533, 0.9999334901066533, 0.9999287393999857, 0.9999334901066533, 0.9999239886933181, 0.9999334901066533, 0.9999334901066533, 0.9999239886933181, 0.9999287393999857, 0.9999287393999857, 0.9999334901066533]
micro_F1List [0.9954036395351058, 0.9987771834727837, 0.9990961774384169, 0.9995374421614988, 0.9998635132899354, 0.9997346358318518, 0.9998587456276251, 0.9998885353785231, 0.9998997445658119, 0.9998997445658119, 0.9998997445658119, 0.9998936410810089, 0.9998997445658119, 0.9998875381329918, 0.9998997440778093, 0.9998997440778093, 0.9998900664363388, 0.9999076913941441, 0.9998936410810089, 0.9999137943421612]
starting retraining
K= 4 top_k_indices [ 9 23 26 28]
init data completed!
2024-11-18 19:15:24.201234: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-18 19:15:24.279729: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-18 19:15:24.383736: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-18 19:15:24.597141: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-18 19:15:24.609748: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-18 19:15:24.619064: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-18 19:15:24.646280: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-18 19:15:24.654601: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-18 19:15:24.668213: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-18 19:15:24.691130: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-18 19:15:24.692444: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-18 19:15:24.711502: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-18 19:15:24.711597: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-18 19:15:24.711867: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-18 19:15:24.725759: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21668 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
start retraining...
Macro-F1: 0.9998971519268278
Micro-F1: 0.9999192379866505
Epoch 1 completed, average loss: 2.3808085465025646, duration: 2074.20 seconds
Macro-F1: 0.9998971519268278
Micro-F1: 0.9999192379866505
Epoch 2 completed, average loss: 0.365446595140185, duration: 492.60 seconds
Macro-F1: 0.999911950071283
Micro-F1: 0.9999429915199886
Epoch 3 completed, average loss: 0.27185540670028957, duration: 503.59 seconds
Macro-F1: 0.9999262400461407
Micro-F1: 0.9999477422266562
Epoch 4 completed, average loss: 0.10319656921080363, duration: 515.95 seconds
